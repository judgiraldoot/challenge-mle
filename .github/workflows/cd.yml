name: 'Continuos Deployment'

on:
  push:
    branches:
      - develop
  pull_request:
    branches:
      - main

jobs:
  deploy_cloud_run_service: 
    name: Deploy cloud run service
    runs-on: ubuntu-latest
    
    permissions:
      contents: read
      id-token: write

    steps:
    - uses: actions/checkout@v4

    - uses: 'google-github-actions/auth@v2'
      with:
        credentials_json: '${{ secrets.GCP_SA_KEY }}' 

    - id: deploy
      uses: google-github-actions/deploy-cloudrun@v2
      with:
        service: delay-model 
        image: us-docker.pkg.dev/mle-challenge-419205/gcr.io/delay_model:latest  